# 分布式服务器管理系统 - MVP开发计划

## 🎯 MVP目标

创建一个**最小可行产品**，实现分布式服务器的基础管理功能，验证系统架构的可行性。

### 核心价值主张
- **快速部署**: 一键启动Core和Node，无复杂配置
- **实时监控**: 查看节点状态和基础系统指标
- **远程执行**: 在节点上执行Shell命令并查看结果
- **简单易用**: 通过Flutter客户端进行可视化管理

---

## 📋 功能范围

### ✅ MVP包含功能
1. **节点管理**
   - 节点自动注册与身份验证
   - 节点在线状态监控
   - 心跳检测机制

2. **系统监控**
   - CPU使用率采集
   - 内存使用率采集  
   - 磁盘使用率采集
   - 系统负载监控

3. **远程命令执行**
   - 单节点命令执行
   - 实时查看执行结果
   - 命令历史记录

4. **基础客户端**
   - 节点列表展示
   - 监控数据可视化
   - 命令执行界面

### ❌ MVP不包含功能 (后续版本)
- 用户权限管理 (使用简单token认证)
- 节点分组管理
- 告警系统
- 审计日志
- 批量命令执行
- 高级监控指标
- 数据备份恢复

---

## 🗂 开发阶段

### 阶段1: 基础架构搭建 (已完成 ✅)
**目标**: 建立项目骨架和开发环境
**耗时**: 1天

- [x] 创建Rust workspace项目结构
- [x] 配置core和node两个子项目
- [x] 设计MVP版本数据库结构
- [x] 验证cargo build构建成功

### 阶段2: Core服务端开发 (进行中 🔄)
**目标**: 实现Core服务的核心功能
**耗时**: 3-4天

#### 2.1 数据库模块 (1天)
- [x] SQLite数据库初始化
- [x] 创建数据库表结构
- [x] 实现基础CRUD操作
- [x] 数据库连接池配置

#### 2.2 WebSocket通信 (1天)
- [x] WebSocket服务器搭建
- [x] 节点连接管理
- [ ] 数据监控
- [ ] 心跳检测机制
- [ ] 消息路由分发

#### 2.3 REST API (1天)
- [x] HTTP服务器搭建
- [x] 节点管理API
- [ ] 监控数据查询API
- [ ] 命令执行API

#### 2.4 安全认证 (0.5天)
- [ ] 简单token认证
- [ ] 密钥生成和验证
- [ ] 请求鉴权中间件

#### 2.5 集成测试 (0.5天)
- [ ] 单元测试编写
- [ ] API接口测试
- [ ] 端到端测试

### 阶段3: Node代理开发 (2天)
**目标**: 实现Node代理的核心功能

#### 3.1 系统信息采集 (0.5天)
- [ ] CPU/内存/磁盘监控
- [ ] 系统负载采集
- [ ] 定时数据收集

#### 3.2 WebSocket客户端 (0.5天)
- [ ] 连接Core服务
- [ ] 自动重连机制
- [ ] 心跳维持

#### 3.3 节点注册与认证 (0.5天)
- [ ] 节点自动注册
- [ ] 身份验证
- [ ] 配置文件读取

#### 3.4 命令执行器 (0.5天)
- [ ] Shell命令执行
- [ ] 结果捕获和返回
- [ ] 超时和错误处理

### 阶段4: Flutter客户端开发 (3天)
**目标**: 实现基础的管理界面

#### 4.1 项目结构搭建 (0.5天)
- [ ] Flutter项目重构
- [ ] 状态管理选型 (Provider/Riverpod)
- [ ] 网络请求封装

#### 4.2 核心页面开发 (2天)
- [ ] 节点列表页面
- [ ] 节点详情和监控页面
- [ ] 命令执行页面
- [ ] 设置页面

#### 4.3 数据可视化 (0.5天)
- [ ] 监控数据图表
- [ ] 实时数据更新
- [ ] 响应式UI设计

### 阶段5: 系统集成与测试 (2天)
**目标**: 端到端功能验证

#### 5.1 集成测试 (1天)
- [ ] Core-Node通信测试
- [ ] Client-Core API测试
- [ ] 多节点场景测试

#### 5.2 用户体验优化 (0.5天)
- [ ] 错误处理和提示
- [ ] 加载状态优化
- [ ] 界面交互改进

#### 5.3 部署准备 (0.5天)
- [ ] 构建脚本编写
- [ ] 配置文件模板
- [ ] 部署文档编写

---

## 📊 技术实现细节

### Core服务技术栈
```rust
// 主要依赖
axum = "0.8"           // HTTP服务器
tokio-tungstenite = "0.27"  // WebSocket
sqlx = "0.8"           // 数据库ORM  
serde = "1.0"          // 序列化
uuid = "1.0"           // ID生成
tracing = "0.1"        // 日志
```

### Node代理技术栈
```rust
// 主要依赖
tokio-tungstenite = "0.27"  // WebSocket客户端
sysinfo = "0.37"            // 系统信息
serde = "1.0"               // 序列化
config = "0.15"             // 配置文件
```

### Flutter客户端技术栈
```yaml
# 主要依赖
http: ^1.2.0              # 网络请求
provider: ^6.1.0          # 状态管理
fl_chart: ^0.68.0         # 图表组件
shared_preferences: ^2.3.0  # 本地存储
```

---

## 🗓 里程碑时间表

| 里程碑 | 完成日期 | 主要交付物 |
|--------|----------|------------|
| M1: 项目架构 | ✅ 已完成 | 项目骨架、数据库设计 |
| M2: Core服务 | Day 5 | 可运行的Core服务 |
| M3: Node代理 | Day 7 | 可运行的Node代理 |
| M4: Flutter客户端 | Day 10 | 基础管理界面 |
| M5: MVP发布 | Day 12 | 完整MVP系统 |

---

## 🧪 验收标准

### MVP成功标准
1. **功能完整性**
   - [ ] 至少支持2个Node节点注册
   - [ ] 实时监控数据正常显示
   - [ ] 命令执行成功率>95%
   - [ ] 客户端界面功能完整

2. **性能标准**
   - [ ] Node注册响应时间<3秒
   - [ ] 监控数据更新延迟<10秒
   - [ ] 命令执行响应时间<5秒
   - [ ] 客户端界面流畅无卡顿

3. **稳定性标准**
   - [ ] Core服务连续运行24小时无崩溃
   - [ ] Node代理自动重连机制正常
   - [ ] 异常情况下的错误提示友好

### 演示场景
1. **节点管理演示**
   - 启动Core服务
   - 启动2个Node代理
   - 在客户端查看节点列表和状态

2. **监控功能演示**
   - 查看实时CPU、内存使用率
   - 观察监控数据图表更新
   - 验证历史数据查询

3. **命令执行演示**
   - 执行简单系统命令 (ls, ps, df)
   - 查看命令输出结果
   - 验证错误命令的处理

---

## 🔄 后续版本规划

### v0.2.0 (MVP+1个月)
- 用户权限管理系统
- 节点分组功能
- 批量命令执行
- 基础告警功能

### v0.3.0 (MVP+2个月)  
- 更丰富的监控指标
- 数据可视化增强
- 移动端适配优化
- 配置管理界面

### v1.0.0 (MVP+3个月)
- 完整的RBAC权限系统
- 审计日志功能
- 数据备份恢复
- 插件扩展机制

---

## 💡 开发建议

### 开发原则
1. **简单优先**: 选择最简单可行的实现方案
2. **功能聚焦**: 严格控制MVP范围，避免功能蔓延
3. **快速迭代**: 每个阶段都要有可演示的成果
4. **用户导向**: 以实际使用场景验证功能设计

### 技术决策
1. **数据库**: 使用SQLite而非PostgreSQL，降低部署复杂度
2. **认证**: 使用简单token而非完整的用户系统
3. **通信**: WebSocket用于实时通信，REST API用于查询
4. **部署**: 单二进制文件，无外部依赖

### 质量保证
1. **代码规范**: 使用rustfmt和clippy保证代码质量
2. **错误处理**: 完善的错误处理和用户友好的错误信息
3. **日志记录**: 结构化日志，便于问题定位
4. **文档更新**: 随着开发进度及时更新文档

---

*最后更新: 2025-01-21*